<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:WpfApp1">
    <DataTemplate x:Key="ColumnSplitterTemplate">
        <local:SimpleGridSplitter Grid.Column="{Binding ColumnIndex}"
                                      Grid="{Binding Path=., RelativeSource={RelativeSource AncestorType={x:Type Grid}}}"
                          Width="2" HorizontalAlignment="Stretch" 
                                  ResizeBehavior="BasedOnAlignment" ResizeDirection="Auto"/>
    </DataTemplate>

    <DataTemplate x:Key="ColumnHeaderTemplate">
        <TextBlock Text="{Binding Text}"
                       HorizontalAlignment="Center" VerticalAlignment="Center" />
    </DataTemplate>

    <DataTemplate x:Key="RowTemplate">
        <Border BorderThickness="0, 1" BorderBrush="OrangeRed"
                >
            <TextBox Text="{Binding Text}"
                         TextAlignment="Center"
                         local:FocusExtensions.IsFocused="{Binding IsFocused}">
                <TextBox.InputBindings>
                    <KeyBinding Key="Up" Command="{Binding UpCommand}" />
                    <KeyBinding Key="Down" Command="{Binding DownCommand}" />
                </TextBox.InputBindings>
                <TextBox.Style>
                    <Style TargetType="{x:Type TextBox}">
                        <Setter Property="Background" Value="White"/>
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding IsUp}" Value="True">
                                <Setter Property="TextBox.Background" Value="LightGreen" />
                            </DataTrigger>
                            <DataTrigger Binding="{Binding IsDown}" Value="True">
                                <Setter Property="TextBox.Background" Value="Tomato" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                    </TextBox.Style>
            </TextBox>
        </Border>
    </DataTemplate>

    <local:RowTemplateSelector x:Key="RowTemplateSelector"
                                              ColumnHeaderTemplate="{StaticResource ColumnHeaderTemplate}"
                                              RowTemplate="{StaticResource RowTemplate}" />

    <DataTemplate x:Key="ColumnTemplate">
        <ItemsControl Margin="0" ItemsSource="{Binding Rows}"
                          ItemTemplateSelector="{StaticResource RowTemplateSelector}">

            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>
                    <VirtualizingStackPanel />
                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

        </ItemsControl>
    </DataTemplate>

    <local:ColumnTemplateSelector x:Key="ColumnTemplateSelector"
                                              ColumnSplitterTemplate="{StaticResource ColumnSplitterTemplate}"
                                              ColumnTemplate="{StaticResource ColumnTemplate}" />

    <DataTemplate DataType="{x:Type local:TableViewModel}">
        <ItemsControl Margin="5" ItemsSource="{Binding Columns}"                      
                       ItemTemplateSelector="{StaticResource ColumnTemplateSelector}">
            <ItemsControl.ItemsPanel>
                <ItemsPanelTemplate>

                    <Grid local:GridExtensions.StarColumns="{Binding StarColumns}"
                        local:GridExtensions.ColumnCount="{Binding ColumnCount}"
                          local:GridExtensions.SharedSizeGroups="{Binding SharedSizeGroups}"
                        />

                </ItemsPanelTemplate>
            </ItemsControl.ItemsPanel>

            <ItemsControl.Template>
                <ControlTemplate TargetType="ItemsControl">
                    <Border BorderThickness="1" BorderBrush="DarkGreen">
                        <ItemsPresenter/>

                    </Border>
                </ControlTemplate>
            </ItemsControl.Template>

            <ItemsControl.ItemContainerStyle>
                <Style>
                    <Setter Property="Grid.Column" Value="{Binding ColumnIndex}"/>
                </Style>
            </ItemsControl.ItemContainerStyle>

            <!--<Button Grid.Column="0" HorizontalAlignment="Center" VerticalAlignment="Center" 
                       Content="Left Side"/>

            <GridSplitter Grid.Column="1" HorizontalAlignment="Stretch" Parent="{Binding Path=., RelativeSource={RelativeSource AncestorType={x:Type Grid}}}"
                          ResizeDirection="Columns" ResizeBehavior="CurrentAndNext" 
                          ToolTip="Drag left-right to resize" DragEnter="GridSplitter_DragEnter" DragStarted="GridSplitter_DragStarted"
                          GotFocus="GridSplitter_GotFocus" DragOver="GridSplitter_DragOver"
                          />

            <Button Grid.Column="2" HorizontalAlignment="Center" VerticalAlignment="Center" 
                       Content="Right Side"/>-->

        </ItemsControl>
    </DataTemplate>
</ResourceDictionary>